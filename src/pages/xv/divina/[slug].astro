---
import { getCollection, getEntry } from "astro:content";
import Hero from "../../../components/xv/divina/Hero.astro";
import "../../../styles/global.css";
import Layout from "../../../layouts/Layout.astro";
import Welcome from "../../../components/xv/divina/Welcome.astro";
import Date from "../../../components/xv/divina/Date.astro";
import Detalles from "../../../components/xv/divina/Detalles.astro";
import Asistencia from "../../../components/xv/divina/Asistencia.astro";
import Wishlist from "../../../components/xv/divina/Wishlist.astro";
import Galeria from "../../../components/xv/divina/Galeria.astro";
import Reproductor from "../../../components/xv/divina/Reproductor.astro";
import GoogleFotos from "../../../components/xv/divina/GoogleFotos.astro";
// 1. Esta función se llama durante el build
export async function getStaticPaths() {
  const entries = await getCollection("xv");

  return entries.map((entry) => ({
    params: { slug: entry.id },
  }));
}

// 2. Obtener los datos del YAML según el slug
const { slug } = Astro.params;
const entry = await getEntry("xv", slug);

if (!entry) {
  throw new Error(`No se encontró contenido para el slug: ${slug}`);
}

const {
  titulo,
  descripcion,
  quinceanera,
  imagenes,
  color_primario,
  color_secundario,
  colorBackground,
  colorAdornos,
  colorTexto,
  mostrarGaleria,
  familiares,
  fecha,
  misa,
  recepcion,
  whatsapp,
  google_fotos,
} = entry.data;
---

<!-- 3. Renderizar -->
<Layout 
  titulo={titulo} 
  descripcion={descripcion} 
  slug={slug}
  quinceanera={quinceanera}
  imagenes={imagenes}
  fecha={fecha}
>
  <Reproductor colorPrimario={color_primario} />

  <Hero
    imagenes={imagenes}
    quinceanera={quinceanera}
    colorPrimario={color_primario}
    colorBackground={colorBackground || color_secundario}
    fecha={fecha}
  />
  <Welcome
    familiares={familiares}
    colorPrimario={color_primario}
    colorBackground={colorBackground || color_secundario}
    colorAdornos={colorAdornos}
    colorTexto={colorTexto}
  />
  <Date
    fecha={fecha}
    fecha_evento={fecha.fecha_iso}
    imagenes={imagenes}
    colorPrimario={color_primario}
    colorBackground={colorBackground || color_secundario}
    colorTexto={colorTexto}
    colorAdornos={colorAdornos}
  />
  <Detalles 
    misa={misa} 
    recepcion={recepcion} 
    colorPrimario={color_primario}
    colorBackground={colorBackground || color_secundario}
    imagenes={imagenes}
    colorTexto={colorTexto}
  />
  {mostrarGaleria !== false && (
    <Galeria 
      imagenes={imagenes} 
      colorPrimario={color_primario}
      colorBackground={colorBackground || color_secundario}
    />
  )}
  <Wishlist 
    colorPrimario={color_primario}
    colorBackground={colorBackground || color_secundario}
  />
  {google_fotos && (
    <GoogleFotos 
      google_fotos={google_fotos} 
      colorPrimario={color_primario}
      colorBackground={colorBackground || color_secundario}
    />
  )}
  <Asistencia 
    whatsapp={whatsapp} 
    colorPrimario={color_primario}
    colorBackground={colorBackground || color_secundario}
  />
</Layout>
